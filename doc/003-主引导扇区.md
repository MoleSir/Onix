# 主要引导扇区

## BISO

Basic Input Output System

BIOS 在加电自检，将主引导扇区度 0x7c00 位置，并跳转到这里执行。

    int 0x10; BIOS 系统调用，显示器相关的功能

## 实模式

8086 模式，此时 CPU 的功能为 16 位；相对的是保护模式，可以是 32 位或者 64 位。系统会先到实模式，之后切换到保护模式。

- Real Mode
- Proteced Mode

### 实模式的寻址方式

在 boot.asm 中，执行了以下代码：

```asm
; 0xb8000 文本显示器的内存
mov ax, 0xb800
mov ds, ax
mov byte [0], 'H'
```

对第一句，其实是希望把 0xb8000 移入 ax 寄存器，但写程序只要写 0xb800。这与当前实模式的寻址方式有关。

寻址方式：

$$
有效地址 = 段地址 * 16 + 偏移地址
$$


根据这个公式，计算：

$$
EA(有效地址) = 0xb800 * 0x10 + 0 = 0xb8000
$$

是没错的。

### 实模式寻址方式的意义

在实模式下，寄存器是 16 位，但需要访问 1M 的地址，需要 20 条地址线，还差 4 位地址，所以公式中的 0x10 就可以提供这 4 根地址线。

进入保护模式后，寄存器有 32 位，不需要使用这种寻址方式。

## 主引导扇区

### 结构

主引导扇区占一个扇区：512 个字节：

- 前 446 个字节是代码；
- 之后 64 个是硬盘分区表：64B = 4 * 16B；
- 最后两个字节是魔数：0xaa55

### 功能

读取内核加载去，并执行。
